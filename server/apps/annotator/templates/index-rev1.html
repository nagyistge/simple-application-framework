{% extends "base-rev1.html" %}

{% block head %}



<script src="static/rev1/js/angular.min.js"></script>
<script src="static/rev1/js/ui-bootstrap-tpls-0.7.0.js"></script>
<script src="static/rev1/js/angular-sanitize.js"></script>
<script src="static/rev1/js/angular-xml.min.js"></script>

<script src="static/rev1/js/mousetrap.min.js"></script>
<script src="static/rev1/js/state-machine.min.js"></script>
<script src="static/rev1/angular-toggle-switch/angular-toggle-switch.min.js"></script>
<script src="static/rev1/angular-bootstrap-colorpicker-2.0/js/bootstrap-colorpicker-module.js"></script>
<script type="text/javascript" src="static/rev1/js/jquery-ui-1.10.3.custom.min.js"></script>

<!-- <script src="static/js/openseadragon.js"></script> -->
<script src="static/rev1/js/ol-whitespace.js"></script>

<script type="text/javascript" src="static/rev1/js/pf-segmentation.js"></script>
<script type="text/javascript" src="static/rev1/js/slic-segmentation.js"></script>
<script type="text/javascript" src="static/rev1/js/segment-annotator.js"></script>

<script src="static/rev1/dermapp-rev1.js"></script>

<!--<link rel=stylesheet type=text/css href="{{ url_for('static', filename='bootstrap-switch/bootstrap-switch.css') }}"/>-->
<link rel=stylesheet type=text/css href="static/rev1/angular-toggle-switch/angular-toggle-switch.css"/>
<link rel=stylesheet type=text/css href="static/rev1/ol.css"/>
<link rel=stylesheet type=text/css
      href="static/rev1/angular-bootstrap-colorpicker-2.0/css/colorpicker.css"/>

<link rel=stylesheet type=text/css href="static/rev1/derm.css"/>



{% endblock %}

{% block body %}

{% if g.user %}

    <input id="user_email" type="hidden" value="{{ g.user.user_email }}"/>
    <input id="user_id" type="hidden" value="{{ g.user.id }}"/>


{% raw %}

    <div id="angular_id" ng-controller="ApplicationController">
                
            <div ng-controller="AnnotationView" id="viewContainer">

                
                <div id="map" class="map"></div>

                <div id="annotatorcontainer"></div>


                <div id="toolContainer" ng-controller="AnnotationTool" >
                    
                    <!-- <div class=""> -->
                    <!-- <progress percent="stacked"></progress> -->
                    <!-- </div> -->

                    
                    <div ng-class="showIfStep(-1) ? 'step-header step-active' : 'step-header'">
                        <span>Select image</span><span class="pull-right"><small>{{active_image.Study_num}}</small></span>
                    </div>

                    <div ng-show="showIfStep(-1)">
                        <div class="step-content">You have completed {{completedImages}} of {{totalItems}} in your current task list. 
                            <!-- <br><small>(Start index: {{ startingIndex}}</small>) -->

                            <div class="imagePreview">
                                
                                <div class="imagePreviewInner">
                                    <div class="" ng-repeat="(key, value) in image_list">
                                        <img class="imagethumb" ng-click='selectImage(key)' src="{{value.thumbnail}}"/>
                                    </div>
                                </div>
                                    
                            </div>
                        </div>    

                        <div class="step-content">
                                <button ng-show="totalSteps" 
                                        href="#" 
                                        ng-click="nextStep()"
                                        class="btn btn-success btn-block">
                                        Begin
                                </button>
                        </div>         
                    </div>


                    <div class="" ng-repeat="(key, value) in decision_tree">

                        <div 
                            ng-click="gotoStep(key)"
                            ng-show="showIfStepGTE(key) || stepHasAnnotations(key)"
                            ng-class="showIfStep(key) ? 'step-header step-active' : 'step-header'"
                            >
                            <span>Step {{key+1}}. {{value.title}}</span>
                            <span class="pull-right" ng-show="stepHasAnnotations(key)">âˆš</span>
                        </div>   

                        <div ng-show="showIfStep(key)" class="step-content">


                            <!-- Need to support:
                             simple, 
                             advanced, 
                             symmetry, 
                             darkcolor, 
                             allcolor -->

                             <div class="btn-group">
                                <button class="btn btn-inverse">?</button>
                             </div>

                             <!-- Advanced -->
                             <div class="btn-group"
                                    ng-show="compareState('advanced', tool_bar_state)">

                                <button
                                    ng-click="startMagicWand()"
                                    class="btn btn-primary">
                                        Wand
                                </button>

                                <button
                                    ng-click="startRegionPaint()"
                                    class="btn btn-primary">
                                        Paint
                                </button>

                                <button
                                    ng-click="startPointList()"
                                    class="btn btn-primary">
                                        Points
                                </button>

                            </div>



                             <!-- magic wand -->
                             
                             <div class="btn-group" 
                                ng-show="compareState('mwdefine', tool_bar_state)">

                                <div class="btn btn-inverse" disabled>
                                   Click image to select seed point
                                </div>

                            </div>

                            <div class="btn-group pull-right" 
                                ng-show="compareState('mwdefine', tool_bar_state)">
                                <div class="btn btn-danger" ng-click="resetStep()">
                                X
                                </div>

                            </div>



                            <!-- Region paint -->

                            <div class="btn-group" 
                                ng-show="compareState('rpdefine', tool_bar_state)">

                                <div class="btn btn-inverse" disabled>
                                   Center feature, then click "GO"
                                </div>
                                <div class="btn btn-info"
                                    ng-click="runRegionPaint()">
                                    GO
                                </div>

                            </div>

                            <div class="btn-group pull-right" 
                                ng-show="compareState('rpdefine', tool_bar_state)">
                                <div class="btn btn-danger" ng-click="resetStep()">
                                X
                                </div>
                            </div>

                            

                            <div class="btn-group" 
                                ng-show="compareState('rppaint', tool_bar_state)">

                                <div class="btn btn-inverse" disabled>
                                   Fill in region, then click "Done"
                                </div>
                                <div class="btn btn-info"
                                    ng-click="finishRegionPaint()">
                                    Done
                                </div>

                            </div>


                            <div class="btn-group pull-right" 
                                ng-show="compareState('rppaint', tool_bar_state)">
                                <div class="btn btn-danger" ng-click="cancelRegionPaint()">
                                X
                                </div>
                            </div>


                            <div class="btn-group" 
                                ng-show="compareState('rpreview', tool_bar_state)">

                            </div>


                            <div class="btn-group pull-right" 
                                ng-show="compareState('rpreview', tool_bar_state)">
                                <div class="btn btn-danger" ng-click="resetStep()">
                                X
                                </div>
                            </div>
                            

                            <!-- point list -->


                            <div class="btn-group" 
                                ng-show="compareState('pldefine', tool_bar_state)">

                                <div class="btn btn-inverse" disabled>
                                    Define perimeter, then click add
                                </div>


                            </div>

                            <div class="btn-group pull-right" 
                                ng-show="compareState('pldefine', tool_bar_state)">

                                
                                <div class="btn btn-danger" ng-click="resetStep()">
                                X
                                </div>

                            </div>



                            <!-- symmetry -->

                             <div class="btn-group" 
                                ng-show="compareState('symmetry', tool_bar_state)">
                            
                                <div class="btn btn-inverse" disabled>
                                    Place 2 points
                                </div>

                            </div>


                            <div class="btn-group">
                                <button type="button" 
                                    class="btn btn-success" 
                                    ng-click="saveCurrentPointsAsPolygon()" 
                                    ng-show="hasTemporaryAnnotations()" >
                                    Add + 
                                </button>
                            </div>


                            <!-- Select -->

                            <div class="btn-group select_group" 
                                ng-show="compareState('select', tool_bar_state)">

                                <div class="btncontainer" ng-repeat="(key,value) in select_stack">
                                    <img class="btnimage" src="{{value.url}}"/>
                                </div>

                            </div>

                            <div class="btn-group"
                                ng-show="compareState('select', tool_bar_state)">

                                <div class="btn btn-danger" ng-click="resetStep()">
                                X
                                </div>
                            </div>


                            <!-- Review selections -->
                            <div class="btn-group select_group" 
                                ng-show="compareState('review', tool_bar_state)">

                                <div class="btncontainer" ng-repeat="(key,value) in select_stack">
                                    <img class="btnimage" src="{{value.url}}"/>
                                </div>

                            </div>

                            <div class="btn-group"
                                ng-show="compareState('review', tool_bar_state)">

                                <div class="btn btn-danger" ng-click="resetStep()">
                                X
                                </div>
                                
                            </div>

                            <div class="btn-group pull-right">
                                <button type="button" 
                                    class="btn btn-success" 
                                    ng-click="nextStep()"
                                    ng-show="compareState('review', tool_bar_state)" >
                                    Next 
                                </button>
                            </div>




                            <!-- Annotate selection -->

                            <div class="btn-group" 
                                ng-show="compareState('selectadvanced', tool_bar_state)">

                                <div class="btncontainer">
                                    <img class="btnimage" src="{{select_last.url}}"/>
                                </div>

                                <button
                                    ng-click="startMagicWand()"
                                    class="btn btn-primary">
                                        Wand
                                </button>

                                <button
                                    ng-click="startRegionPaint()"
                                    class="btn btn-primary">
                                        Paint
                                </button>

                                <button
                                    ng-click="startPointList()"
                                    class="btn btn-primary">
                                        Points
                                </button>

                            </div>

                            <div class="btn-group"
                                ng-show="compareState('selectadvanced', tool_bar_state)">

                                <div class="btn btn-danger" ng-click="resetStep()">
                                X
                                </div>
                                
                            </div>




                            

                            <!-- Choice -->

                            <div class="btn-group"
                                ng-show="compareState('end', tool_bar_state)">

                                <div class="btn btn-inverse" disabled>
                                    Click Next to submit final annotation
                                </div>

                            </div>


                            <!-- Default -->

                            <div class="btn-group pull-right"
                                ng-show="compareState(value.type, tool_bar_state)">
                                <button
                                        ng-click="nextStep()"
                                        class="btn btn-success">
                                        Next
                                </button>
                            </div> 


                            

                            <!--  -->


                            <div class="advancedoptions">
                                    
                                <div class="optionitem" 
                                    ng-show="compareState('select', tool_bar_state)"
                                    ng-repeat="(key, value) in step_options">

                                        <div class="" href="#" ng-click="selectOption(key, value )">
                                            <img class="optionimage" src="static/rev1/{{step_base}}/{{key+1}}.jpg"/>
                                        </a>
                                </div>
                            </div>
                        </div>
                    </div>                    
                </div>
            </div>
        </div>


    </div>







    {% endraw %}

  {% else %}

    {% raw %}


      <div class="jumbotron">
        <h1>MSKCC/Emory Derm Annotator</h1>
        <p class="lead">Below are current links to various prototypes and resouces for annotation of Melanomas</p>
      </div>

      <hr>

      <div class="row-fluid">
        <div class="span6">
          <h4>Pathology Image viewer for Whole Slide Images</h4>
          <p><a href="http://mskcc.digitalslidearchive.net">Pathology and Dermoscopic Lesion Viewer</a></p>

          <h4>Classify Derm Lesions by Example</h4>
          <p><a href="http://sideshowbob.psy.emory.edu/dan1000_livedev/DERM_annotator/web_dev/">Same as above on different host in case of any weird network issues</a></p>

          <h4>Alpha Version of Simple Annotator</h4>
          <p><a href="http://dermannotator.org">Shows online annotation capabilities</a></p>
        </div>

        <div class="span6">
            <br>
        </div>
      </div>

      <hr>

      <h4>Videos</h4>
      <div class="row-fluid">
          <div class="span12">
              <small>I recommend downloading these to your machine (right click, save-as) if your internet connection is
              not great. PLEASE NOTE: You can change the quality to 720p by clicking on the cog icon.</small>
          </div>

      </div>

      <div class="row-fluid">

        <div class="span6">
            <iframe width="420" height="315" src="http://www.youtube.com/embed/_bIwrv1P4XM" frameborder="0" allowfullscreen></iframe><br>
            <a href="http://node15.cci.emory.edu/MSKCC/VIDEOS/atlas_select_closest_pick_next_image_to_score.avi">
            Random image is displayed, the rater picks the best example in the template, and then a new image is generated to assess</a><br>
        </div>

        <div class="span6">
         <iframe width="420" height="315" src="http://www.youtube.com/embed/0XIFcb5tH9Y" frameborder="0" allowfullscreen></iframe><br>
         <a href="http://node15.cci.emory.edu/MSKCC/VIDEOS/clinical_portal_with_filtering_and_zoomto.avi">
         This highlight the clinical portal, viewing of various metadata and properties, and shows when you double click an image the full zoomable image appears</a><Br>
        </div>

      </div>
        <br>
      <div class="row-fluid">

        <div class="span6">
           <iframe width="420" height="315" src="http://www.youtube.com/embed/In4HGQJTDMQ" frameborder="0" allowfullscreen></iframe><br>
           <a href="http://node15.cci.emory.edu/MSKCC/VIDEOS/mskcc_flash_portal_for_wsi.avi">Adobe Flash Based portal with both dermoscopic and high res (400X) pathology slides </a><br>
        </div>

        <div class="span6">
            <iframe width="420" height="315" src="http://www.youtube.com/embed/03oBPbwpTfA" frameborder="0" allowfullscreen></iframe><br>
            <a href="http://node15.cci.emory.edu/MSKCC/VIDEOS/Cutaneous_melanoma_whole_slide_image.avi">This shows zooming/panning functionality, the ability to annotate a spot and zoom back to it, as well as basic ROI drawing</a></br>

        </div>


      </div>

       <hr>

    {% endraw %}

  {% endif %}

{% endblock %}


{% block postjs %}


{% endblock %}