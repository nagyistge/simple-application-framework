{% extends "base.html" %}

{% block head %}



<script src="static/bower_components/angular/angular.min.js"></script>
<script src="static/bower_components/angular-ui-bootstrap-bower/ui-bootstrap-tpls.min.js"></script>
<script src="static/bower_components/angular-sanitize/angular-sanitize.min.js"></script>
<script src="static/bower_components/angular-xml/angular-xml.min.js"></script>
<script src="static/bower_components/mousetrap/mousetrap.min.js"></script>

<script type="text/javascript" src="static/js/ol-whitespace.js"></script>

<script type="text/javascript" src="static/js/pf-segmentation.js"></script>
<script type="text/javascript" src="static/js/slic-segmentation.js"></script>
<script type="text/javascript" src="static/js/segment-annotator.js"></script>
<script type="text/javascript" src="static/js/dermapp-revise.js"></script>

<link rel=stylesheet type=text/css href="static/css/ol.css"/>
<link rel=stylesheet type=text/css href="static/css/derm.css"/>

{% endblock %}

{% block body %}

{% if g.user %}

    <input id="user_email" type="hidden" value="{{ g.user.user_email }}"/>
    <input id="user_id" type="hidden" value="{{ g.user.id }}"/>



    <div id="angular_id" ng-controller="ApplicationController">
                
            <div ng-controller="AnnotationView" id="viewContainer">

                
                <div id="map" class="map"></div>

                <div id="annotatorcontainer"></div>


                <div id="toolContainer" ng-controller="AnnotationTool" >



                    <!-- <div class=""> -->
                    <!-- <progress percent="stacked"></progress> -->
                    <!-- </div> -->

                    <!--<div>-->
                        <div class="isichead">
                            <span class="isictitle pull-left">ISIC Annotation Tool</span>
                            <span class="isicuser pull-right">User: {{g.user.user_email}}
                                [<a href="{{ url_for('logout') }}">sign out</a>]</span>
                            <div class="clearfix"></div>
                        </div>

                    <!--</div>-->

{% raw %}

                    
                    <div ng-class="showIfStep(-1) ? 'step-header step-active' : 'step-header'">
                        <span>Select image</span><span class="pull-right"><small>{{active_image.Study_num}}</small></span>
                    </div>

                    <div ng-show="showIfStep(-1)">
                        <div class="step-content">
                            <!-- <br><small>(Start index: {{ startingIndex}}</small>) -->

                            <div class="imagePreview">
                                
                                <div class="imagePreviewInner">
                                    <div class="" ng-repeat="(key, value) in image_list">
                                        <img class="imagethumb" ng-click='selectImage(key)' src="{{value.thumbnail}}"/>
                                    </div>
                                </div>
                                    
                            </div>
                            <div>
                                You have completed {{completedImages}} of {{totalItems}} in your current task list.
                            </div>

                        </div>    

                        <div class="step-content">
                                <button ng-show="totalSteps" 
                                        href="#" 
                                        ng-click="nextStep()"
                                        class="btn btn-success">
                                        Begin
                                </button>
                        </div>         
                    </div>


                    <div class="" ng-repeat="(key, value) in decision_tree">

                        <div 
                            ng-click="gotoStep(key)"
                            ng-show="showIfStepGTE(key) || stepHasAnnotations(key)"
                            ng-class="showIfStep(key) ? 'step-header step-active' : 'step-header'"
                            >
                            <span>{{value.title}}</span>
                            <span class="pull-right"
                                  ng-show="stepHasAnnotations(key)"><i class="fa fa-check-square"></i>&nbsp;</span>
                        </div>   

                        <div ng-show="showIfStep(key)" class="step-content">



                            <div class="btn-group">
                                <div class="btn btn-danger" ng-click="resetStep()">
                                X
                                </div>
                            </div>



                             <!-- Advanced -->
                             <div class="btn-group"
                                    ng-show="compareState('advanced', tool_bar_state)">

                                <button
                                    ng-click="startMagicWand()"
                                    class="btn btn-primary">
                                        Magic Wand
                                </button>

                                <button
                                    ng-click="startRegionPaint()"
                                    class="btn btn-primary">
                                        Region Paint
                                </button>

                                <button
                                    ng-click="startPointList()"
                                    class="btn btn-primary">
                                        Perimeter
                                </button>

                            </div>



                             <!-- magic wand -->
                             
                             <div class="btn-group" 
                                ng-show="compareState('mwdefine', tool_bar_state)">

                                <div class="btn btn-info">{{magicwand_tolerance}}</div>

                                 <div class="btn"
                                      ng-click="decreaseParameter()">
                                     <i class="fa fa-chevron-down"></i></div>
                                <div class="btn"
                                      ng-click="increaseParameter()">
                                     <i class="fa fa-chevron-up"></i></div>

                                 <div class="btn btn-inverse" disabled>
                                   Click image to select seed point
                                </div>


                            </div>

                            <!--<div class="btn-group pull-right" -->
                                <!--ng-show="compareState('mwdefine', tool_bar_state)">-->
                                <!--<div class="btn btn-danger" ng-click="resetStep()">-->
                                <!--X-->
                                <!--</div>-->

                            <!--</div>-->




                            <!-- Region paint -->

                            <div class="btn-group" 
                                ng-show="compareState('rpdefine', tool_bar_state)">

                                <div class="btn btn-inverse" disabled>
                                   Center feature, then click "GO"
                                </div>
                                <div class="btn btn-info"
                                    ng-click="runRegionPaint()">
                                    GO
                                </div>

                            </div>

                            <!--<div class="btn-group pull-right" -->
                                <!--ng-show="compareState('rpdefine', tool_bar_state)">-->
                                <!--<div class="btn btn-danger" ng-click="resetStep()">-->
                                <!--X-->
                                <!--</div>-->
                            <!--</div>-->


                            <div class="btn-group"
                                ng-show="compareState('rpreview', tool_bar_state)">

                                <div class="btn btn-inverse" disabled>
                                   Accept?
                                </div>

                            </div>
                            

                            <div class="btn-group" 
                                ng-show="compareState('rppaint', tool_bar_state)">

                                <div class="btn btn-inverse" disabled>
                                   Fill in region, then click "Done"
                                </div>


                            </div>

                            <div class="btn-group pull-right"
                                 ng-show="compareState('rppaint', tool_bar_state)">

                                <div class="btn btn-success"
                                    ng-click="finishRegionPaint()">
                                    <i class="fa fa-plus-square"></i>
                                </div>
                            </div>


                            <!--<div class="btn-group pull-right" -->
                                <!--ng-show="compareState('rppaint', tool_bar_state)">-->
                                <!--<div class="btn btn-danger" ng-click="cancelRegionPaint()">-->
                                <!--X-->
                                <!--</div>-->
                            <!--</div>-->





                            <!--<div class="btn-group pull-right" -->
                            <!--ng-show="compareState('rpreview', tool_bar_state)">-->
                                <!--<div class="btn btn-danger" ng-click="resetStep()">-->
                                <!--X-->
                                <!--</div>-->
                            <!--</div>    -->
                        <!---->
                            

                            <!-- point list -->


                            <div class="btn-group" 
                                ng-show="compareState('pldefine', tool_bar_state)">

                                <div class="btn btn-inverse" disabled>
                                    Define perimeter, then click add
                                </div>


                            </div>

                            <div class="btn-group pull-right" 
                                ng-show="compareState('pldefine', tool_bar_state)">

                                
                                <div class="btn btn-danger" ng-click="resetStep()">
                                X
                                </div>

                            </div>



                            <!-- symmetry -->

                             <div class="btn-group" 
                                ng-show="compareState('symmetry', tool_bar_state)">
                            
                                <div class="btn btn-inverse" disabled>
                                    Place 2 points
                                </div>

                            </div>


                            <div class="btn-group pull-right">
                                <button type="button" 
                                    class="btn btn-info"
                                    ng-click="saveCurrentPointsAsPolygon()" 
                                    ng-show="hasTemporaryAnnotations()" >
                                    <i class="fa fa-plus-square"></i>
                                </button>
                            </div>




                            <!-- Select -->

                            <div class="btn-group select_group" 
                                ng-show="compareState('select', tool_bar_state)">

                                <div class="btncontainer" ng-repeat="(key,value) in select_stack">
                                    <img class="btnimage" src="{{value.url}}"/>
                                </div>

                            </div>

                            <!--<div class="btn-group"-->
                                <!--ng-show="compareState('select', tool_bar_state)">-->

                                <!--<div class="btn btn-danger" ng-click="resetStep()">-->
                                <!--X-->
                                <!--</div>-->
                            <!--</div>-->


                            <!-- Review selections -->
                            <div class="btn-group select_group" 
                                ng-show="compareState('review', tool_bar_state)">

                                <div class="btncontainer" ng-repeat="(key,value) in select_stack">
                                    <img class="btnimage" src="{{value.url}}"/>
                                </div>

                            </div>

                            <!--<div class="btn-group"-->
                                <!--ng-show="compareState('review', tool_bar_state)">-->

                                <!--<div class="btn btn-danger" ng-click="resetStep()">-->
                                <!--X-->
                                <!--</div>-->
                                <!---->
                            <!--</div>-->

                            <div class="btn-group pull-right">
                                <button type="button" 
                                    class="btn btn-success" 
                                    ng-click="nextStep()"
                                    ng-show="compareState('review', tool_bar_state)" >
                                    Next 
                                </button>
                            </div>




                            <!-- Annotate selection -->

                            <div class="btn-group" 
                                ng-show="compareState('selectadvanced', tool_bar_state)">

                                <div class="btncontainer">
                                    <img class="btnimage" src="{{select_last.url}}"/>
                                </div>

                                <button
                                    ng-click="startMagicWand()"
                                    class="btn btn-primary">
                                        Magic Wand
                                </button>

                                <button
                                    ng-click="startRegionPaint()"
                                    class="btn btn-primary">
                                        Region Paint
                                </button>

                                <button
                                    ng-click="startPointList()"
                                    class="btn btn-primary">
                                        Perimeter
                                </button>

                            </div>

                            <div class="btn-group"
                                ng-show="compareState('selectadvanced', tool_bar_state)">

                                <div class="btn btn-danger" ng-click="resetStep()">
                                X
                                </div>
                                
                            </div>




                            

                            <!-- Choice -->

                            <div class="btn-group"
                                ng-show="compareState('end', tool_bar_state)">

                                <div class="btn btn-inverse" disabled>
                                    Click Next to submit final annotation
                                </div>

                            </div>


                            <!-- Default -->

                            <div class="btn-group pull-right"
                                ng-show="compareState(value.type, tool_bar_state)">
                                <button
                                        ng-click="nextStep()"
                                        class="btn btn-success">
                                        Next
                                </button>
                            </div> 


                            

                            <!--  -->


                            <div class="advancedoptions">
                                    
                                <div class="optionitem" 
                                    ng-show="compareState('select', tool_bar_state)"
                                    ng-repeat="(key, value) in step_options">

                                        <div class="" href="#" ng-click="selectOption(key, value )">
                                            <img class="optionimage" src="static/rev2/{{step_base}}/{{key+1}}.jpg"/>
                                        </a>
                                </div>
                            </div>
                        </div>
                    </div>                    
                </div>
            </div>
        </div>


    </div>







    {% endraw %}

  {% else %}

    {% raw %}


      <div class="container">

          <div class="row">
            <div class="span12">
              <h4>Pathology Image viewer for Whole Slide Images</h4>
              <p><a href="http://mskcc.digitalslidearchive.net">Pathology and Dermoscopic Lesion Viewer</a></p>

              <h4>Classify Derm Lesions by Example</h4>
              <p><a href="http://sideshowbob.psy.emory.edu/dan1000_livedev/DERM_annotator/web_dev/">Same as above on different host in case of any weird network issues</a></p>

              <h4>Alpha Version of Simple Annotator</h4>
              <p><a href="http://dermannotator.org">Shows online annotation capabilities</a></p>
            </div>

          </div>


      </div>

    {% endraw %}

  {% endif %}

{% endblock %}


{% block postjs %}


{% endblock %}